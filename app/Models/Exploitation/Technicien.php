<?php

namespace App\Models\Exploitation;

use App\Models\Architecture\Site;
use Carbon\Carbon;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\SoftDeletes;

class Technicien extends Model
{
    use SoftDeletes;
    protected $fillable = ['code', 'nom_complet', 'site_id', 'telephone', 'interne'];
    protected $dates = ['created_at'];
    protected $casts = ['interne' => 'boolean'];

    public function codeGenerate(): void
    {
        $rang = $this->count() + 1;
        $this->attributes['code'] = TECHNICIEN_CODE_PREFIXE . str_pad((string) $rang, 5, '0', STR_PAD_LEFT) . Carbon::now()->format('y');
    }

    public function getAlias(): string
    {
        return $this->attributes['nom_complet'] . ' ' . $this->attributes['code'];
    }

    public function site(): BelongsTo
    {
        return $this->belongsTo(Site::class);
    }
}
